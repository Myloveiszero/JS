<script>
    let a = [1,2,[3,[4,[5]]]];
    // function flat(a) {
    //     a.forEach((b) => {
    //         if (typeof b === 'object') {
    //             flat(b)
    //         } else {
    //             res.push(b)
    //         }
    //     })
    //     return res
    // }

    a.push(a);
    let map = new Map();
    function flat(arr) {   
        let res = [];
     if(map.get(arr)) return map.get(arr);
     map.set(arr, res)
     for(let item of arr) {
        if(Array.isArray(item)){
            // res = res.concat(flat(item));
            res.push(...flat(item));
        }
        else {
            res.push(item)
        }
     }
     return res;
    }
console.log(flat(a));
</script>